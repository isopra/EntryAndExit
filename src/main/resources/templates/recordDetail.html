<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>入退室管理</title>
	<meta http-equiv="Content-Type"
    	content="text/html; charset=UTF-8" />
    <link href="/css/recordDetail.css" th:href="@{/css/recordDetail.css}" rel="stylesheet" >
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
</head>

<body onload="Firstlocation()">
	<div id="container">
	<h1 th:if="${mode} == 1">入室記録</h1>
	<h1 th:if="${mode} == 2">退室記録</h1>
		<form id="form" action="" th:object="${formModel}">
			<div id="border">

				<p class="gap" th:text="日付：+ ${#dates.format(new java.util.Date(),'yyyy/MM/dd')}"></p>
				<input th:value="${#dates.format(new java.util.Date(),'yyyy/MM/dd')}" name="record_date" type="hidden" id="record_date">

				<div class="gap">拠点 :
				<select name="location_id" id="location_id">
				<td th:each="obj: ${locationList}" >
					<option  th:if="${obj.delete_flag == false}"th:text=${obj.name} th:value="${obj.location_id}"></option>
				</td>
				</select>
				</div>

			<!-- 入室時 -->
				<p class="gap" th:if="${mode} == 1">入室者：
				<span th:each="obj: ${memberList}"><span th:if="${obj.person_id} == ${personId}">
				<input name="entry_member_id" th:text="${obj.name}" id="entry_member_id" th:value="${obj.member_id}" type="hidden" >
				</span></span></p>
				<p class="gap" th:text="入室時刻： + ${#dates.format(new java.util.Date(),'yyyy-MM-dd HH:mm:ss')}" th:if="${mode} == 1"></p>
			    <input th:if="${mode} == 1" name="entry_time" id="entry_time" th:value="${#dates.format(new java.util.Date(),'yyyy-MM-dd HH:mm:ss')}" type="hidden">

			<!-- 退室時 -->
			<span th:if="${mode} == 2" th:each="obj, objStat : ${recordList}">
				<span th:if="${objStat.last} == true">
					<input type="hidden" th:value="${obj.entry_member_id}" id="entry_member_id" name="entry_member_id"/>
					<input type="hidden" th:value="${obj.entry_time}" id="entry_time" name="entry_time"/>
				</span>
				</span>
				<p class="gap" th:if="${mode} == 2">退室者：
				<span th:each="obj: ${memberList}"><span th:if="${obj.person_id} == ${personId}">
				<input name="exit_member_id" th:text="${obj.name}" id="exit_member_id" th:value="${obj.member_id}" type="hidden" >
				</span></span></p>
				<p class="gap" th:text="退室時刻： + ${#dates.format(new java.util.Date(),'yyyy-MM-dd HH:mm:ss')}" th:if="${mode} == 2"></p>
			    <input th:if="${mode} == 2" name="exit_time" id="exit_time" th:value="${#dates.format(new java.util.Date(),'yyyy-MM-dd HH:mm:ss')}" type="hidden">

			</div>

 			<input type="hidden" id="created_time" name="created_time" th:value="${#dates.format(new java.util.Date(),'yyyy-MM-dd HH:mm:ss')}"/>

			<div id="right">
				<button type="button" id="regist" onclick="Registration()" th:value="${mode}" class="button" ontouchstart="">登録</button>
			</div>

		</form>

		<form action="/" id="left">
			<input type="submit" value="キャンセル" id="cancel" class="button" ontouchstart=""/>
		</form>
	</div>

	<script th:inline="javascript">

    function Registration(){

    	var mode = document.getElementById('regist').value;
    	var locationCheck = document.getElementById("location_id").value;

    	document.cookie = locationCheck;

    	if(mode == 1){
    		alert("入室時間を記録しました。");
    		$('form').attr('action',"/recordDetail/regist/1");
    		$("#form").submit();
    	}else if(mode == 2) {
    		alert("退室時間を記録しました。");
    		$('form').attr('action',"/recordDetail/regist/2");
    		$("#form").submit();
    	}else {
    		alert("error: 入退室時間を記録できませんでした。");
    	}
    }

    function Firstlocation(){
    	//データを一つずつに分ける
    	var r = document.cookie.split(';');
		var locationName = "";
		var content = "";
    	r.forEach(function(value) {

    	    //cookie名と値に分ける
    	     content = value.split('=');

    	})
    	if(content[0] != ""){
    		var location_T = [[${locationList}]];
    		for(i = 0; i < location_T.length;i++){
    			if(location_T[i].location_id.toString() == content[0])
    				locationName = location_T[i].name;
    		}
    		var location_element = document.getElementById("location_id");
    		var element = null;
    		element = '<option value='+ content[0] +' selected>'+locationName+'</option>';
     		for(i = 0; i < location_T.length;i++){
    		if(location_T[i].location_id.toString() != content[0])
    		element += '<option text='+ location_T[i].name +' value='+ location_T[i].location_id +'>'+ location_T[i].name +'</option>';
    		}
     		location_element.innerHTML = element;
    	}

    }
    </script>

</body>
</html>